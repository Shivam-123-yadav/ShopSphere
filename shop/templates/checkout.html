{% extends "base.html" %}
{% block content %}

<h3 class="mb-4 fw-bold text-gradient" style="letter-spacing:1px;">Checkout</h3>

<div class="row g-4">
  <!-- Addresses + Checkout Form -->
  <div class="col-12 col-md-6">
    <div class="p-4 rounded-4 shadow-sm bg-white bg-opacity-75 border border-2 border-warning-subtle animate__animated animate__fadeInLeft">
      <h5 class="mb-3">Choose Delivery Address</h5>
      {% if addresses %}
        <form method="post">
          {% csrf_token %}
          {% for addr in addresses %}
            <div class="form-check mb-2 address-radio">
              <input class="form-check-input" type="radio" name="address_id" id="addr{{ addr.id }}" value="{{ addr.id }}">
              <label class="form-check-label" for="addr{{ addr.id }}">
                <span class="fw-semibold text-dark">{{ addr.label }}</span>: {{ addr.full_name }}, {{ addr.address }}, {{ addr.city }}, {{ addr.postal_code }}
              </label>
            </div>
          {% endfor %}
          <button type="submit" name="select_address" class="btn btn-warning w-100 rounded-pill fw-bold shadow-sm mt-2"><i class="fas fa-location-dot me-1"></i> Use Selected Address</button>
        </form>
      {% endif %}

      <h5 class="mt-4 mb-2">Or Add New Address</h5>
      <form method="post">
        {% csrf_token %}
        <div class="address-form-fields">{{ form.as_p }}</div>
        <button type="submit" class="btn btn-success w-100 rounded-pill fw-bold shadow-sm mt-2"><i class="fas fa-plus me-1"></i> Add Address & Place Order</button>
      </form>
    </div>
  </div>

  <!-- Order Summary -->
  <div class="col-12 col-md-6">
    <div class="p-4 rounded-4 shadow-lg bg-white bg-opacity-75 border border-2 border-warning-subtle animate__animated animate__fadeInRight">
      <h5 class="mb-3">Order Summary</h5>
      <ul class="list-group list-group-flush">
        {% for item in cart_items %}
        <li class="list-group-item d-flex align-items-center flex-wrap bg-transparent">
          {% if item.product.images.first %}
            <img src="{{ item.product.images.first.image.url }}" 
                 alt="{{ item.product.name }}" 
                 class="img-fluid rounded-3 me-3 mb-2 mb-sm-0 border border-2 border-warning-subtle" 
                 style="width:60px; height:60px; object-fit:cover;">
          {% else %}
            <img src="https://via.placeholder.com/60" 
                 alt="{{ item.product.name }}" 
                 class="img-fluid rounded-3 me-3 mb-2 mb-sm-0 border border-2 border-warning-subtle">
          {% endif %}

          <div class="flex-grow-1 mb-1 mb-sm-0">
            <strong>{{ item.product.name }}</strong><br>
            <span class="badge bg-light text-dark border border-warning-subtle">Qty: {{ item.quantity }}</span>
          </div>

          <span class="fw-bold text-success fs-5">₹{{ item.total_price }}</span>
        </li>
        {% endfor %}

        <li class="list-group-item d-flex justify-content-between fw-bold bg-transparent border-top mt-2 pt-2">
          Total
          <span class="text-gradient fs-5">₹{{ total }}</span>
        </li>
      </ul>
    </div>
  </div>
</div>

<style>
.text-gradient {
  background: linear-gradient(90deg, #FFD700, #FFA500 80%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.address-radio input[type="radio"]:checked + label, .address-radio input[type="radio"]:focus + label {
  background: linear-gradient(90deg, #fffbe6, #fff3cd);
  border-radius: 0.6rem;
  box-shadow: 0 2px 8px #FFD70022;
  padding: 0.2rem 0.5rem;
  transition: background 0.2s;
}
.address-form-fields p { margin-bottom: 0.7rem; }
@media (max-width: 576px) {
  .rounded-4 { border-radius: 1rem !important; }
}
</style>

{% endblock %}
